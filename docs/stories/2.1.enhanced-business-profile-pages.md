# Story 2.1: Enhanced Business Profile Pages

## Status
Approved

## Story
**As a** consumer,
**I want** to view detailed business profiles with comprehensive information, photos, and services,
**so that** I can make informed decisions about which local businesses to engage with.

## Acceptance Criteria
1. Business profile displays complete information: name, description, address, contact details, hours, and website
2. Photo gallery shows business logo, interior/exterior photos, and product/service images with lightbox viewing
3. Services/products catalog allows businesses to list offerings with descriptions and pricing information
4. Business hours display shows current open/closed status and special holiday hours
5. Location map integration shows business location with directions link
6. Contact methods clearly presented (phone, email, website) with click-to-call functionality on mobile
7. Business category tags help consumers understand the type of business
8. Profile pages are mobile-responsive and load quickly on all devices

## Tasks / Subtasks
- [x] **Task 1: Business Profile Component Architecture** (AC: 1, 8)
  - [x] Create BusinessProfile component in apps/mobile/src/components/business/BusinessProfile/
  - [x] Implement responsive layout using NativeBase components
  - [x] Add business information display sections (header, description, details)
  - [x] Create business profile routing and navigation
  - [x] Implement loading states and error handling
  - [x] Add pull-to-refresh functionality for profile updates
  - [x] Optimize component performance with React.memo and useMemo

- [x] **Task 2: Business Information Display** (AC: 1, 7)
  - [x] Create business header with name, category tags, and rating display
  - [x] Implement business description with expandable text for long content
  - [x] Add address display with formatted location information
  - [x] Create contact information section with phone, email, website
  - [x] Implement business category badge components
  - [x] Add social media links section (if provided)
  - [x] Create business verification status indicator

- [x] **Task 3: Photo Gallery Implementation** (AC: 2)
  - [x] Create PhotoGallery component with horizontal scrolling
  - [x] Implement lightbox modal for full-screen photo viewing
  - [x] Add photo navigation (previous/next) within lightbox
  - [x] Create photo loading with placeholder and error states
  - [x] Implement photo lazy loading for performance
  - [x] Add photo zoom and pan functionality in lightbox
  - [x] Create photo caption display and metadata

- [x] **Task 4: Services/Products Catalog** (AC: 3)
  - [x] Create ServicesCatalog component for offerings display
  - [x] Implement service item cards with name, description, pricing
  - [x] Add service categorization and organization
  - [x] Create pricing display with multiple format support (range, exact, quote)
  - [x] Implement service booking integration preparation
  - [x] Add service availability and duration information
  - [x] Create service filtering and search within catalog

- [ ] **Task 5: Business Hours Display** (AC: 4)
  - [ ] Create BusinessHours component with current status indicator
  - [ ] Implement weekly schedule display with expand/collapse
  - [ ] Add real-time open/closed status calculation
  - [ ] Create special hours overlay for holidays and temporary changes
  - [ ] Implement countdown timer for next status change
  - [ ] Add time zone handling for user location
  - [ ] Create hours validation and error handling

- [ ] **Task 6: Location Map Integration** (AC: 5)
  - [ ] Integrate Google Maps or MapView component
  - [ ] Display business location with custom marker
  - [ ] Add directions link integration with native maps app
  - [ ] Implement map interaction (zoom, pan) with business marker focus
  - [ ] Create address display with copy-to-clipboard functionality
  - [ ] Add parking information and accessibility details
  - [ ] Implement map loading states and error handling

- [ ] **Task 7: Contact Methods Integration** (AC: 6)
  - [ ] Create ContactMethods component with action buttons
  - [ ] Implement click-to-call functionality using Linking API
  - [ ] Add email composition link with pre-filled subject
  - [ ] Create website link with external browser handling
  - [ ] Implement contact preference indicators
  - [ ] Add business response time information
  - [ ] Create contact method availability status

- [ ] **Task 8: Performance and Accessibility** (AC: 8)
  - [ ] Implement image optimization and lazy loading
  - [ ] Add accessibility labels and screen reader support
  - [ ] Create responsive design breakpoints for mobile/tablet
  - [ ] Implement caching for business profile data
  - [ ] Add performance monitoring and error tracking
  - [ ] Create SEO optimization for web platform
  - [ ] Implement dark mode support for profile pages

## Dev Notes

### Previous Story Insights
Story 1.4 (Basic Business Listing Creation) established the business data structure and creation flow. This story focuses on the consumer-facing display of that business information with enhanced UI/UX.

### Business Data Model Context
[Source: architecture/data-models.md#business]
**Complete Business Interface Available:**
```typescript
interface Business {
  id: string;
  ownerId: string;
  name: string;
  description: string;
  location: {
    address: string;
    city: string;
    state: string;
    zipCode: string;
    latitude: number;
    longitude: number;
  };
  categories: string[];
  hours: {
    [key: string]: {
      open: string;
      close: string;
      isClosed: boolean;
    };
  };
  contact: {
    phone?: string;
    email?: string;
    website?: string;
  };
  media: {
    id: string;
    url: string;
    type: 'logo' | 'photo';
    description?: string;
  }[];
  services: {
    id: string;
    name: string;
    description: string;
    price?: number;
    duration?: number;
  }[];
  isActive: boolean;
  createdAt: Date;
  updatedAt: Date;
}
```

### Frontend Component Architecture Context
[Source: architecture/frontend-architecture.md#component-organization]
**Component Structure:**
```
apps/mobile/src/components/business/
├── BusinessProfile/          # Main profile component
├── BusinessCard/            # Business preview card
├── PhotoGallery/           # Photo display component
├── ServicesCatalog/        # Services/products display
├── BusinessHours/          # Hours and status display
├── ContactMethods/         # Contact action buttons
└── index.ts
```

**Component Template Pattern:**
```typescript
import React from 'react';
import { Box, Text, Image } from 'native-base';
import { Business } from 'packages/shared/src/types/business';

interface BusinessProfileProps {
  business: Business;
  onContactPress?: (method: string) => void;
  onServiceSelect?: (serviceId: string) => void;
}

export const BusinessProfile: React.FC<BusinessProfileProps> = ({
  business,
  onContactPress,
  onServiceSelect
}) => {
  // Component implementation with NativeBase styling
};
```

### API Integration Context
[Source: architecture/api-specification.md]
**Business Profile API:**
- `GET /businesses/{businessId}` - Retrieve complete business details
- Response includes all business information, media URLs, services, hours
- Caching strategy for frequently accessed business profiles
- Error handling for non-existent or inactive businesses

### Tech Stack Context
[Source: architecture/tech-stack.md]
- **UI Framework**: NativeBase 3.5+ for consistent cross-platform components
- **Maps Integration**: Google Maps API for location display and directions
- **Image Handling**: S3 CDN URLs with lazy loading and caching
- **State Management**: Zustand for business profile state
- **Navigation**: React Navigation for profile routing

### Mobile-Specific Implementation
**React Native Considerations:**
- **Linking API**: For click-to-call, email, and website functionality
- **Image Caching**: Use FastImage or similar for optimized image loading
- **Maps Integration**: react-native-maps for native map components
- **Performance**: FlatList for services catalog, Image lazy loading
- **Accessibility**: Screen reader support with accessibility labels

### Business Hours Logic Context
**Hours Calculation Requirements:**
- Real-time open/closed status based on current time and business timezone
- Special hours override standard weekly schedule
- Holiday hours and temporary closures handling
- Time zone conversion for user's local time display
- Next status change calculation (opens in 2 hours, closes in 30 minutes)

### Contact Methods Integration
**Native Mobile Actions:**
```typescript
// Click-to-call implementation
const handlePhonePress = (phoneNumber: string) => {
  Linking.openURL(`tel:${phoneNumber}`);
};

// Email composition
const handleEmailPress = (email: string, businessName: string) => {
  Linking.openURL(`mailto:${email}?subject=Inquiry about ${businessName}`);
};

// Website opening
const handleWebsitePress = (website: string) => {
  Linking.openURL(website);
};
```

### Photo Gallery Implementation
**Image Display Requirements:**
- Lazy loading for performance with placeholder images
- Lightbox modal with gesture-based navigation
- Image optimization from S3 CDN with multiple sizes
- Logo vs photo differentiation in display
- Error handling for broken image URLs
- Zoom and pan functionality in lightbox view

### Testing Requirements Context
[Source: architecture/testing-strategy.md]
**Component Tests:**
- `apps/mobile/tests/components/BusinessProfile.test.tsx`
- `apps/mobile/tests/components/PhotoGallery.test.tsx`
- `apps/mobile/tests/components/BusinessHours.test.tsx`

**Test Scenarios:**
- Business profile rendering with complete data
- Photo gallery navigation and lightbox functionality
- Business hours calculation and status display
- Contact method interactions (phone, email, website)
- Services catalog display and interaction
- Map integration and directions functionality
- Responsive design and accessibility compliance

### Performance Optimization Context
**Mobile Performance Requirements:**
- Image lazy loading to reduce initial load time
- Component memoization to prevent unnecessary re-renders
- API response caching to reduce network requests
- Progressive loading of sections (basic info first, then photos/services)
- Memory management for large photo galleries

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2025-01-05 | 1.0 | Initial story creation | Bob (Scrum Master) |

## Dev Agent Record

### Agent Model Used
Claude Sonnet 4 (claude-sonnet-4-20250514) - BMad Dev Agent

### Debug Log References
*To be populated by development agent*

### Completion Notes List
1. **Task 1 - Business Profile Component Architecture**: Enhanced existing BusinessProfile component with performance optimizations, loading states, error handling, and pull-to-refresh functionality. Added React.memo, useMemo, and useCallback for optimal performance.

2. **Task 2 - Business Information Display**: Created comprehensive business information display system with rating system, expandable text, business verification badges, social media integration, and enhanced category system. Implemented 6 new specialized components with full TypeScript support and comprehensive testing.

### File List
**Enhanced Files:**
- apps/mobile/src/components/business/BusinessProfile/BusinessProfile.tsx (enhanced with performance optimizations, state management, and new component integrations)
- apps/mobile/src/components/business/BusinessProfile/types.ts (added new interfaces for rating, verification, and social media)
- packages/shared/src/types/business.ts (extended Business interface with rating, verification, and social media fields)

**New Components Created:**
- apps/mobile/src/components/business/BusinessProfile/BusinessHeader.tsx (enhanced business header with rating and verification)
- apps/mobile/src/components/business/BusinessProfile/BusinessRating.tsx (star rating display system)
- apps/mobile/src/components/business/BusinessProfile/BusinessVerification.tsx (verification status indicator)
- apps/mobile/src/components/business/BusinessProfile/BusinessSocialMedia.tsx (social media links integration)
- apps/mobile/src/components/business/BusinessProfile/ExpandableText.tsx (expandable description component)
- apps/mobile/src/components/business/BusinessProfile/BusinessCategoryBadges.tsx (enhanced category badge system)

**Enhanced Tests:**
- apps/mobile/src/components/business/BusinessProfile/__tests__/BusinessProfile.test.tsx (comprehensive test coverage)
- apps/mobile/src/components/business/BusinessProfile/__tests__/BusinessRating.test.tsx (rating component tests)
- apps/mobile/src/components/business/BusinessProfile/__tests__/ExpandableText.test.tsx (expandable text functionality tests)

## QA Results
*To be populated by QA agent*